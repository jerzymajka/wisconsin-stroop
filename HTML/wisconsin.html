<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test sortowania kart z Wisconsin</title>
    <style>
        .grid-container {
            display: grid;
            grid-template-columns: auto auto auto;
            padding: 0px;
        }

        .grid-container1 {
            display: grid;
            margin-right: 8%;
            margin-left: 8%;
            grid-template-columns: auto auto auto auto;
            padding: 0px;
        }

        .grid-item {
            padding: 0px;
            text-align: center;
        }

        .container {
            margin: 15px;
            margin-right: 15%;
            margin-left: 8%;
        }

        .form-group {
            margin: 10px;
        }

        .alert {
            color: red;
        }

        .in {
            width: 50%;
            border: solid 1px #eee;
            padding: 15px 10px;
        }

        .btn {
            width: 200px;
            padding: 15px;
            margin: 25px;
            background: #fff;
            color: dodgerblue;
            border: solid 1px dodgerblue;
            cursor: pointer;
            transition: all 0.38s ease-in-out;
        }

        .name {
            font-size: 1.3em;
            color: rgb(214, 58, 19);
            font-weight: bold;
        }

        .name:hover {
            background: dodgerblue;
        }

        button:hover {
            background: dodgerblue;
            color: #fff;
        }
    </style>
</head>

<body>
    <a href="home">home</a>
    <div class="container" id="cont">
        <div class="grid-container">
            <div>
                <img src="blanck.gif">
                <p>Seria: <span class="name" id="ser"> 1</span>.</p>
                <p>Pozostało: <span class="name" id="powt"> 5</span>. </p>
                <p>Prawidłowe odpowiedzi z rzędu: <span class="name" id="rzad"> 0</span>.</p>
                <p>Błędy w tej serii:  <span class="name" id="blad"> 0</span>.</p>
                <p>Czas: <span class="name" id="czas"> 0</span>.</p>
            </div>
            <div class="grid-item"><img src="greenstar2_test.gif" alt="obr" id="obrazek" height="80%"></div>
            <div class="grid-item"><img src="blanck.gif"></div>
        </div>    
        <h1 style="color: rgb(255, 255, 255); text-align: center;" id="komunikat">Dobrze</h1>
        <div class="grid-container1">
            <div class="grid-item" id="daa" onclick="getId(this)"><img src="redtriangle1_test.gif" height="80%"></div>
            <div class="grid-item" id="adb" onclick="getId(this)"><img src="greenstar2_test.gif" height="80%"></div>
            <div class="grid-item" id="bcc" onclick="getId(this)"><img src="yellowcross3_test.gif" height="80%"></div>
            <div class="grid-item" id="cbd" onclick="getId(this)"><img src="bluecircle4_test.gif" height="80%"></div>
        </div>
    </div>
    <script>
<<<<<<< HEAD
        const gifName = [
            "GreenTriangle3.gif", "RedStar4.gif", "YellowCircle1.gif","BlueTriangle2.gif", 
            "YellowCircle2.gif", "BlueTriangle3.gif", "GreenTriangle4.gif","RedStar3.gif", 
            "GreenCross4.gif", "YellowStar1.gif", "GreenCircle3.gif","BlueStar1.gif", 
            "RedCross2.gif",   "BlueStar3.gif","GreenCross1.gif","YellowStar4.gif",
            "BlueCross1.gif", "RedCircle2.gif", "RedCross4.gif", "YellowTriangle2.gif",
            "GreenCircle1.gif", "YellowTriangle4.gif", "BlueCross2.gif", "RedCircle3.gif"
=======
        const gifName = ["GreenTriangle3.gif", "RedStar4.gif","BlueTriangle2.gif", "YellowTriangle4.gif",
            "GreenTriangle4.gif", "YellowTriangle2.gif", "BlueTriangle3.gif", "RedStar3.gif", 
            "YellowStar1.gif", "RedCross4.gif", "BlueStar1.gif",  "GreenCross4.gif",
            "RedCross2.gif", "YellowStar4.gif", "GreenCross1.gif",  "BlueStar3.gif",
            "BlueCross1.gif",  "RedCircle2.gif",  "GreenCircle3.gif","YellowCircle2.gif",
            "GreenCircle1.gif",  "YellowCircle1.gif",  "BlueCross2.gif", "RedCircle3.gif"
>>>>>>> 3a8d1f3bfbfeead331524cffc913d1765b36d867
        ];
        const gifSymbol = [
            'aac', 'ddd', 'bba', 'cab', 
            'bbb', 'cac', 'aad', 'ddc',
            'acd', 'bda', 'abc', 'cda', 
            'dcb', 'cdc', 'aca', 'bdd',
            'cca', 'dbb', 'dcd', 'bab',
            'aba', 'bad', 'ccb', 'dbc'
        ];
        const regula = {
            color: 0,
            ksztalt: 1,
            liczba: 2
        };
        const rezultaty = [{
                regula: 'color',
                liczbaPowt: 0,
                ukonczono: false,
                czas: 0,
                bledyOgulem: 0,
                bledyPers: 0,
                bledyZachRegul: 0
            },
            {
                regula: 'color',
                liczbaPowt: 0,
                ukonczono: false,
                czas: 0,
                bledyOgulem: 0,
                bledyPers: 0,
                bledyZachRegul: 0
            },
            {
                regula: 'color',
                liczbaPowt: 0,
                ukonczono: false,
                czas: 0,
                bledyOgulem: 0,
                bledyPers: 0,
                bledyZachRegul: 0
            },
            {
                regula: 'color',
                liczbaPowt: 0,
                ukonczono: false,
                czas: 0,
                bledyOgulem: 0,
                bledyPers: 0,
                bledyZachRegul: 0
            },
            {
                regula: 'color',
                liczbaPowt: 0,
                ukonczono: false,
                czas: 0,
                bledyOgulem: 0,
                bledyPers: 0,
                bledyZachRegul: 0
            },
            {
                regula: 'color',
                liczbaPowt: 0,
                ukonczono: false,
                czas: 0,
                bledyOgulem: 0,
                bledyPers: 0,
                bledyZachRegul: 0
            }
        ]
        const sekwencja = [
            ['color', 8],
            ['ksztalt', 9],
            ['color', 8],
            ['liczba', 10],
            ['ksztalt', 9],
            ['liczba', 10]
        ];
        let licznikTrafiony = 0;
        let licznikSekwencja = 0;
        let licznikBlad = 0;
        let licznikBladPers = 0;
        let licznikBladZach = 0;
        let licznikBladSerii = 0;
        let aktualnyRegula = Math.floor(Math.random() * 6);
        let staraRegula = aktualnyRegula;
        let trafiony = false;
        let bladZach = false;
        let index1= 0;
        const zwiekszIndex = ()=>{
            if(index1>23){
                index1=0;
            }
            index1++;
            return index1-1;
        }
        const zgodnoscReguly = (regula, index, karta) => {
            return (gifSymbol[index][regula] == karta[regula]) ? true : false;
        }
        const czas = function (time) {
            let sec = Math.floor(time / 1000);
            let dsec = Math.floor((time - sec * 1000) / 100);
            return `${sec}.${dsec}`;
        }
        const href = window.location.href;
        const gotowe = function () {
            window.location.replace(href.replace('wisconsint', 'testy'));
        }
        const obrazek = document.getElementById("obrazek");
        const komunikat = document.getElementById("komunikat");
        const powt = document.getElementById('powt');
        const rzad = document.getElementById('rzad');
        let start = Date.now();
        let startOg = Date.now();
        const czas1 = document.getElementById('czas');
        setInterval(() => {
            czas1.innerText =  czas(Date.now() - startOg);
        }, 100);
        let gifIndex = zwiekszIndex();
        let obrStr = gifName[gifIndex].toLowerCase();
        obrazek.src = obrStr;
        const koniec = function () {
            rezultaty[licznikSekwencja].regula = sekwencja[aktualnyRegula][0];
            rezultaty[licznikSekwencja].liczbaPowt = sekwencja[aktualnyRegula][1] + 1;
            rezultaty[licznikSekwencja].bledyOgulem = licznikBladSerii;
            rezultaty[licznikSekwencja].bledyPers = licznikBladPers == 0 ? 0 : licznikBladPers - 1;
            rezultaty[licznikSekwencja].bledyZachRegul = licznikBladZach;
            rezultaty[licznikSekwencja].czas = czas(Date.now() - start);
            start = Date.now();
            licznikBladSerii = 0;
            licznikBladPers = 0;
            licznikBladZach = 0;
            licznikSekwencja++;
            staraRegula = aktualnyRegula;
            trafiony = true;
            aktualnyRegula++;
            if (aktualnyRegula == 6) {
                aktualnyRegula = 0;
            }
            if (licznikSekwencja == 6) {
                fetch(href, {
                    method: 'post',
                    body: JSON.stringify(rezultaty),
                    headers: {
                        'Content-Type': 'application/json'
                    },
                }).then(res => {
                    if (res.status == 200) {
                        document.getElementById('cont').innerHTML = `<h1>Twoje rezultaty:</h1>
                                    <h2>Ilość błędów: ${licznikBlad}</h2>
                                    <h2>Czas w sekundach: ${czas(Date.now()-startOg)}</h2>
                                    <div class="form-group">
                                    <button class="btn" type="submit" onclick="gotowe()">Gotowe</button></div>`;
                    }
                }).catch((err) => {
                    document.getElementById('cont').innerHTML = `<h2>Wystąpił błąd</h2>
                                    <h3>${err}</h3>
                                    <h3>Spróbuj powtórzyć test, jeśli to nie pomoże, skontaktuj się ze mną:</h3>
                                    <h3>jerzymajka67@gmail.com lub: <a href="mailto: jmajka1@st.swps.edu.pl">jmajka1@st.swps.edu.pl</a> </h2>
                                    `
                })
            }
        }
        const getId = (karta) => {
            if (zgodnoscReguly(regula[sekwencja[aktualnyRegula][0]], gifIndex, karta.id)) {
                licznikTrafiony++;
                trafiony = false;
                bladZach = false;
                rzad.innerHTML = licznikTrafiony;
                if (licznikTrafiony > sekwencja[aktualnyRegula][1]) {
                    rezultaty[licznikSekwencja].ukonczono = true;
                    trafiony = true;
                    koniec();
                }
                komunikat.style = "color: rgb(15, 238, 23); text-align: center;"
                komunikat.innerText = "Dobrze";
            } else {
                if (licznikBladSerii > 20) {
                    koniec();
                } else if (zgodnoscReguly(regula[sekwencja[staraRegula][0]], gifIndex, karta.id) && trafiony) {
                    licznikBladPers++;
                } else {
                    trafiony = false;
                    if (licznikTrafiony > 5 || bladZach) {
                        licznikBladZach++;
                        bladZach = true;
                    }
                }
                licznikTrafiony = 0;
                rzad.innerHTML = licznikTrafiony;
                licznikBlad++;
                licznikBladSerii++;
                document.getElementById('blad').innerText = licznikBladSerii;
                komunikat.style = "color: rgb(248, 62, 37); text-align: center;"
                komunikat.innerText = "Błąd";
                powt.innerHTML = 5 - licznikSekwencja;
                document.getElementById('ser').innerText = licznikSekwencja + 1;
            }
            gifIndex = zwiekszIndex();
            obrazek.src = gifName[gifIndex].toLowerCase();
        }
    </script>
</body>
</html>